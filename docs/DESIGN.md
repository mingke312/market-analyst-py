# Aè‚¡å¸‚åœºæ¯æ—¥åˆ†æç³»ç»Ÿ - ç¨‹åºå¼€å‘è®¾è®¡æ–‡æ¡£

## 1. ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å®šæ—¶ä»»åŠ¡ (Cron)                       â”‚
â”‚                  æ¯æ—¥ 16:00 æ‰§è¡Œ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ•°æ®æ”¶é›†å±‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¡Œæƒ…æ•°æ®æ”¶é›†å™¨  â”‚  æœŸè´§æ•°æ®æ”¶é›†å™¨  â”‚    æ–°é—»æ•°æ®æ”¶é›†å™¨   â”‚
â”‚ collector.js    â”‚ futures-browser.jsâ”‚  collector.js     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®å­˜å‚¨å±‚                           â”‚
â”‚                  storage.js (JSON)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®è´¨é‡æ£€æŸ¥                         â”‚
â”‚                  data-quality.js                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®åˆ†æå±‚                           â”‚
â”‚                   analyzer.js                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æˆäº¤é‡åˆ†æ     â”‚   åŸºå·®åˆ†æ      â”‚     æ–°é—»åˆ†æ        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æŠ¥å‘Šç”Ÿæˆå±‚                           â”‚
â”‚                   reporter.js                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     è¾“å‡ºå±‚                             â”‚
â”‚               é£ä¹¦æ¶ˆæ¯æ¨é€                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. æ¨¡å—è®¾è®¡

### 2.1 æ¨¡å—æ¸…å•

| æ¨¡å— | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| è¡Œæƒ…æ•°æ®æ”¶é›†å™¨ | `market-data-collector/collector.js` | ä»è…¾è®¯è´¢ç»è·å–8ä¸ªæŒ‡æ•°æ•°æ® |
| æœŸè´§æ•°æ®æ”¶é›†å™¨ | `market-data-collector/futures-browser.js` | ä»ä¸œæ–¹è´¢å¯Œè·å–æœŸè´§æ•°æ® |
| æ–°é—»æ•°æ®æ”¶é›†å™¨ | `market-news-collector/collector.js` | ä»æ ¼éš†æ±‡è·å–æ–°é—»æ•°æ® |
| æ•°æ®å­˜å‚¨ | `market-analyzer/storage.js` | ä¿å­˜å’ŒåŠ è½½JSONæ•°æ® |
| äº¤æ˜“æ—¥å† | `trading-calendar.js` | è®¡ç®—äº¤æ˜“æ—¥å’Œåˆ°æœŸæ—¥ |
| æ•°æ®è´¨é‡æ£€æŸ¥ | `data-quality.js` | æ£€æŸ¥æ•°æ®å®Œæ•´æ€§ |
| æ•°æ®åˆ†æ | `market-analyzer/analyzer.js` | ç”Ÿæˆåˆ†æç»“æœ |
| æŠ¥å‘Šç”Ÿæˆ | `report-generator/reporter.js` | ç”ŸæˆMarkdownæŠ¥å‘Š |

### 2.2 æ•°æ®æ ¼å¼è®¾è®¡

#### 2.2.1 è¡Œæƒ…æ•°æ® (market_YYYY-MM-DD.json)

```json
{
  "date": "2026-02-26",
  "type": "indices",
  "data": [
    {
      "code": "sh000001",
      "name": "ä¸Šè¯æŒ‡æ•°",
      "price": 4146.63,
      "prevClose": 4147.23,
      "open": 4151.07,
      "high": 4152.19,
      "low": 4127.15,
      "volume": 651702826,
      "amount": 10671.99,
      "change": -0.6,
      "changePercent": -0.01,
      "changePercentStr": "-0.01%",
      "timestamp": "2026-02-26T13:37:49Z"
    }
  ]
}
```

#### 2.2.2 æœŸè´§æ•°æ® (futures_YYYY-MM-DD.json)

```json
{
  "date": "2026-02-26",
  "type": "futures",
  "data": {
    "IF": {
      "å½“æœˆ": { "price": 4712.2, "settlement": 4731 },
      "ä¸‹å­£": { "price": 4671.2 },
      "éš”å­£": { "price": 4614.8 }
    },
    "IC": { ... },
    "IM": { ... },
    "IH": { ... }
  }
}
```

#### 2.2.3 åŸºå·®æ•°æ® (basis_YYYY-MM-DD.json)

```json
{
  "date": "2026-02-26",
  "data": [
    {
      "index": "IF",
      "contract": "å½“æœˆ",
      "futuresPrice": 4712.2,
      "spotPrice": 4726.87,
      "basis": -14.67,
      "basisPercent": -0.31,
      "annualizedBasis": -7.08,
      "tradingDays": 16,
      "expiryDate": "2026-03-19"
    }
  ]
}
```

#### 2.2.4 åˆ†æç»“æœ (analysis_YYYY-MM-DD.json)

```json
{
  "date": "2026-02-26",
  "marketAnalysis": {
    "volume": { "trend": "...", "interpretation": "..." },
    "basis": [...],
    "changes": {
      "daily": [...],
      "weekly": [...],
      "monthly": [...]
    }
  },
  "newsAnalysis": {
    "summary": "...",
    "highImportance": [...],
    "categories": {...},
    "sentiment": "ä¸­æ€§"
  },
  "conclusion": {
    "marketView": "...",
    "riskAlerts": [...],
    "recommendations": [...]
  }
}
```

## 3. æ¥å£è®¾è®¡

### 3.1 è¡Œæƒ…æ•°æ®æ”¶é›†å™¨

```javascript
// å‘½ä»¤è¡Œ: node collector.js indices
// è¾“å‡º: JSON æ ¼å¼çš„è¡Œæƒ…æ•°æ®

{
  "type": "indices",
  "data": [...],
  "timestamp": "..."
}
```

### 3.2 æœŸè´§æ•°æ®æ”¶é›†å™¨

```javascript
// å‘½ä»¤è¡Œ: node futures-browser.js
// è¾“å‡º: JSON æ ¼å¼çš„æœŸè´§æ•°æ®

{
  "type": "futures",
  "data": {...},
  "timestamp": "..."
}
```

### 3.3 æ–°é—»æ•°æ®æ”¶é›†å™¨

```javascript
// å‘½ä»¤è¡Œ: node collector.js
// è¾“å‡º: JSON æ ¼å¼çš„æ–°é—»æ•°æ®

{
  "type": "news",
  "source": "æ ¼éš†æ±‡",
  "count": 20,
  "data": [...]
}
```

### 3.4 æ•°æ®è´¨é‡æ£€æŸ¥

```javascript
// å‡½æ•°: generateQualityReport(marketData, futuresData, basisData)
// è¿”å›: 

{
  "report": "ğŸ“‹ æ•°æ®è´¨é‡æŠ¥å‘Š...",
  "score": 85,
  "passed": true,
  "details": {...}
}
```

## 4. æ ¸å¿ƒç®—æ³•

### 4.1 åŸºå·®è®¡ç®—

```
åŸºå·® = æœŸè´§ä»·æ ¼ - ç°è´§ä»·æ ¼
åŸºå·®ç‡ = (åŸºå·® / ç°è´§ä»·æ ¼) Ã— 100%
å¹´åŒ–åŸºå·®ç‡ = åŸºå·®ç‡ Ã— (365 / è·åˆ°æœŸäº¤æ˜“æ—¥)
```

### 4.2 äº¤æ˜“æ—¥è®¡ç®—

```javascript
function isTradingDay(dateStr) {
  // æ’é™¤å‘¨æœ« (0=å‘¨æ—¥, 6=å‘¨å…­)
  // æ’é™¤æ³•å®šèŠ‚å‡æ—¥
  return !isWeekend && !isHoliday;
}

function countTradingDays(startDate, endDate) {
  let count = 0;
  let current = new Date(startDate);
  while (current <= endDate) {
    if (isTradingDay(current)) count++;
    current.setDate(current.getDate() + 1);
  }
  return count;
}
```

### 4.3 æœŸè´§åˆ°æœŸæ—¥è®¡ç®—

```javascript
function getExpiryDate(year, month) {
  // è·å–å½“æœˆç¬¬ä¸‰ä¸ªå‘¨äº”
  const firstDay = new Date(year, month - 1, 1);
  const dayOfWeek = firstDay.getDay();
  const friday = 5;
  const firstFriday = firstDay.getDate() + (friday - dayOfWeek + 7) % 7;
  return new Date(year, month - 1, firstFriday + 14);
}
```

## 5. é…ç½®æ–‡ä»¶

### 5.1 å®šæ—¶ä»»åŠ¡é…ç½®

```json
{
  "name": "æ¯æ—¥Aè‚¡æŠ¥å‘Š",
  "schedule": "0 16 * * *",
  "timezone": "Asia/Shanghai",
  "payload": {
    "kind": "agentTurn",
    "message": "æ‰§è¡Œæ•°æ®æ”¶é›†å’Œåˆ†æä»»åŠ¡..."
  }
}
```

### 5.2 äº¤æ˜“æ—¥å†é…ç½® (trading-calendar.js)

```javascript
module.exports = {
  holidays2026: [...],
  futuresExpiryDates: [...],
  
  isTradingDay(dateStr) { ... },
  countTradingDays(start, end) { ... },
  getExpiryDate(yearMonth) { ... }
};
```

## 6. é”™è¯¯å¤„ç†

| é”™è¯¯ç±»å‹ | å¤„ç†æ–¹å¼ |
|----------|----------|
| ç½‘ç»œè¶…æ—¶ | é‡è¯•3æ¬¡ï¼Œæ¯æ¬¡é—´éš”10ç§’ |
| æ•°æ®ä¸ºç©º | è®°å½•è­¦å‘Šï¼Œç»§ç»­æ‰§è¡Œ |
| è§£æå¤±è´¥ | è®°å½•é”™è¯¯ï¼Œè·³è¿‡è¯¥æ•°æ® |
| è´¨é‡æ£€æŸ¥å¤±è´¥ | è‡ªåŠ¨é‡æ–°æŠ“å– |

## 7. æ—¥å¿—è§„èŒƒ

- é”™è¯¯ï¼šä½¿ç”¨ `console.error`
- æ­£å¸¸ï¼šä½¿ç”¨ `console.log` è¾“å‡ºJSON
- è°ƒè¯•ä¿¡æ¯ï¼šä½¿ç”¨ `console.error` è¾“å‡ºåˆ° stderr
